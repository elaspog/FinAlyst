# FinAlyst WebService API

Besides the FinAlyst web based graphical user interface the webservice API
can be used to communicate with FinAlyst server.
The webservice API can be accesses similarly to the web gui, however it is
designed to be used by external applications. All the functions are available
on the webservice API.

Webserice API is only available after authentication. Applications have to send
a login message first. After the application finished working on the remote
server it should close the session by sending a logout message.

## Basic query format

The web service interface implements many queries and also operations that
change the server state. As FinAlyst access needs authentication, all the
requests have to pass the sessionid (returned by the login request), as a GET,
or POST argument. Passing the sessionid as a cookie is also accepted.
The sessionid is a string generated by the server on login.

All the queries and operations returns similar JSON data with the results.

Basic JSON request result format:

|| **Key**      || **Type**     || **Description**              ||
|| success      || bool         || Was the request success      ||
|| status       || integer      || HTTP Status Code             ||
|| data         || mixed        || empty or request result      ||

Login message has an additional sessionid argument.
Queries are implemented as HTTP GET requests, Operations are implemented as
HTTP POST requests.

## Category

### List categories

List all the categories with name and description.

**Request type:** HTTP GET

**Result data:**

*Array of:*

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || category id          ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| name         || string[127]  || category name        ||
|| description  || string[255]  || category description ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/categories

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": [
            {
                "id": 1,
                "create": "/Date(1224043200000)/",
                "modify": "/Date(1228035600000)/",
                "name": "Mobile",
                "description": "Mobile phone expenses"
            }
        ]
    }

### Create category

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**      ||
|| name         || string[127]  || category name        ||
|| description  || string[255]  || category description ||


**Result data:**

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || new category id      ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| name         || string[127]  || category name        ||
|| description  || string[255]  || category description ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/category_add

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": {
            "id": 1,
            "create": "/Date(1224567700000)/",
            "modify": "/Date(1224567700000)/",
            "name": "Bill",
            "description": "Usual bills"
        }
    }


### Edit category

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**                 ||
|| categoryid   || integer      || category id                     ||
|| name         || string[127]  || category name (optional)        ||
|| description  || string[255]  || category description (optional) ||


**Result data:**

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || new category id      ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| name         || string[127]  || category name        ||
|| description  || string[255]  || category description ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/category_edit

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": {
            "id": 1,
            "create": "/Date(1224567700000)/",
            "modify": "/Date(1224567700000)/",
            "name": "Cheese",
            "description": "Special and not so special cheese"
        }
    }


### Destroy category

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**      ||
|| categoryid   || integer      || category id          ||


**Result data:** null

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/category_destroy

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": null
    }


## Item

### List items

**TODO: implement limits**

List all the items with category, amount and description.

**Request type:** HTTP GET

**Result data:**

*Array of:*

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || item id              ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| categoryid   || integer      || category id          ||
|| amount       || integer      || money amount         ||
|| description  || string[255]  || item description     ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/items

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": [
            {
                "id": 1,
                "create": "/Date(1224043200000)/",
                "modify": "/Date(1228035600000)/",
                "categoryid": 3,
                "amount": 2000,
                "description": "Montly mobile bill"
            }
        ]
    }

### Create item

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**      ||
|| categoryid   || integer      || category id          ||
|| amount       || integer      || money amount         ||
|| description  || string[255]  || item description     ||

**Result data:**

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || item id              ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| categoryid   || integer      || category id          ||
|| amount       || integer      || money amount         ||
|| description  || string[255]  || item description     ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/item_add

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": {
            "id": 1,
            "create": "/Date(1224456600000)/",
            "modify": "/Date(1224456600000)/",
            "categoryid": 3,
            "amount": 800,
            "description": "Icecream"
        }
    }

### Edit item

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**             ||
|| itemid       || integer      || item id                     ||
|| categoryid   || integer      || category id (optional)      ||
|| amount       || integer      || money amount (optional)     ||
|| description  || string[255]  || item description (optional) ||

**Result data:**

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || item id              ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| categoryid   || integer      || category id          ||
|| amount       || integer      || money amount         ||
|| description  || string[255]  || item description     ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/item_edit

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": {
            "id": 1,
            "create": "/Date(1224456600000)/",
            "modify": "/Date(1224456600000)/",
            "categoryid": 3,
            "amount": 800,
            "description": "Icecream"
        }
    }

### Destroy item

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**      ||
|| itemid       || integer      || item id              ||


**Result data:** null

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/item_destroy

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": null
    }

    
## Plan item

### List plan items

**TODO: implement limits**

List all the plan items with category, amount and description.

**Request type:** HTTP GET

**Result data:**

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || plan item id         ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| categoryid   || integer      || category id          ||
|| amount       || integer      || money amount         ||
|| description  || string[255]  || item description     ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/planitems

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": [
            {
                "id": 1,
                "create": "/Date(1224043200000)/",
                "modify": "/Date(1228035600000)/",
                "categoryid": 5,
                "amount": 5000,
                "description": "Got 5000Ft for birthday, I will spend it on travelling"
            }
        ]
    }

### Create planitem

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**      ||
|| categoryid   || integer      || category id          ||
|| amount       || integer      || money amount         ||
|| description  || string[255]  || item description     ||

**Result data:**

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || plan item id         ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| categoryid   || integer      || category id          ||
|| amount       || integer      || money amount         ||
|| description  || string[255]  || item description     ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/planitem_add

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": {
            "id": 1,
            "create": "/Date(1224778800000)/",
            "modify": "/Date(1224778800000)/",
            "categoryid": 3,
            "amount": 10000,
            "description": "Got my wage, spend this part on sport"
        }
    }

### Edit planitem

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**             ||
|| planid       || integer      || plan item id                ||
|| categoryid   || integer      || category id (optional)      ||
|| amount       || integer      || money amount (optional)     ||
|| description  || string[255]  || item description (optional) ||

**Result data:**

|| **Key**      || **Type**     || **Description**      ||
|| id           || integer      || plan item id         ||
|| create       || datetime     || create date          ||
|| modify       || datetime     || last modification    ||
|| categoryid   || integer      || category id          ||
|| amount       || integer      || money amount         ||
|| description  || string[255]  || item description     ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/planitem_edit

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": {
            "id": 1,
            "create": "/Date(1224778800000)/",
            "modify": "/Date(1224778800000)/",
            "categoryid": 3,
            "amount": 10000,
            "description": "Got my wage, spend this part on sport"
        }
    }


### Destroy planitem

**Request type:** HTTP POST

**Request arguments:**

|| **Key**      || **Type**     || **Description**      ||
|| planitemid   || integer      || item id              ||


**Result data:** null

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/planitem_destroy

**JSON example:**

    {
        "success": true,
        "status": 200,
        "data": null
    }

## Statistics

### Daily category expenses overview

Calculate plan/expense balance for the specified category for every
week/month or year in the specified timeframe. Balance **always** calculated for
**single** year, granulation (week/month/year) can be specified in the request.
By default balance statistics calculated in the current year, pass 1 (or more)
in relative_year request agrument to get statistics about last year
(or the previous years).


**Request type:** HTTP GET

**Request arguments:**

|| **Key**       || **Type**     || **Description**                                                                ||
|| categoryid    || integer      || plan item id                                                                   ||
|| granulation   || string       || week/month/year                                                                ||
|| relative_year || integer      || unsigned value, search limited this year (optional) (default: 0, current year) ||

**Result data:**

|| **Key**      || **Type**                  || **Description**       ||
|| -            || array of Result Interval  || result interval       ||

**Result Interval**

|| **Key**      || **Type** || **Description**                       ||
|| interval     || integer  || week of year/month/year               ||
|| expensesum   || integer  || sum of expense in the interval        ||
|| plannedsum   || integer  || sum of planned amount in the interval ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/balance_stats?categoryid=46

**JSON example:**

    {
	"success": true,
	"status": 200,
	"data": [
            {
                    interval: 38,
                    expensesum: 1000,
                    plannedsum: 0
            },
            {
                    interval: 40,
                    expensesum: 1000,
                    plannedsum: 1000
            },
	]
    }

### Weekly, montly, yearly statistics

UNFINISHED

**Request type:** HTTP GET

**Request arguments:**

|| **Key**        || **Type**     || **Description**                                                                  ||
|| categoryid     || integer      || plan item id                                                                     ||
|| granulation    || string       || week/month/year                                                                  ||
|| relative_month || integer      || unsigned value, search limited this month (optional) (default: 0, current month) ||

**Result data:**

|| **Key**      || **Type**                  || **Description**       ||
|| -            || array of Result Interval  || result interval       ||

**Result Interval**

|| **Key**      || **Type** || **Description**                       ||
|| interval     || integer  || week of year/month/year               ||
|| expensesum   || integer  || sum of expense in the interval        ||
|| plannedsum   || integer  || sum of planned amount in the interval ||
|| cumulative   || integer  || TODO ||

**Example URL:**
http://myfinalyst/fcgi-bin/finalyst?q=webservice/daily_overview?relative_month=1

**JSON example:**

TODO 
